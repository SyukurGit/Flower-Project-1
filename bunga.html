<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Untukmu Tasya</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    /* ============ RESET & ROOT ============ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root{
      --dark:#0d0c14;
      --rose:#ee5286;
      --rose-deep:#d64277;
      --leaf:#0f6a2b;
      --leaf-deep:#0b4a1e;
      --glow:#ffd1e1;
      --sparkle:#ffccf1;
      --accent:#f6e8d7;
      --soft: cubic-bezier(.22,.61,.36,1);
    }

    html,body{ width:100%; height:100%; overflow:hidden; }
    body{
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(1200px 800px at 50% -10%, #1b1530 0%, #0e0a16 50%, #05040a 100%);
      color:#fff;
    }

    /* ============ SKY ============ */
    .night{
      position:fixed; inset:0;
      background:
        radial-gradient(800px 400px at 50% -10%, rgba(255,188,255,.08), transparent 60%),
        radial-gradient(1500px 800px at 50% 120%, rgba(255,188,255,.06), transparent 60%),
        radial-gradient(200px 200px at 20% 30%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(250px 250px at 80% 25%, rgba(255,255,255,.15), transparent 60%),
        linear-gradient(#0d0b17, #0a0812);
      pointer-events:none;
      z-index:0;
    }

    /* subtle sparkles */
    .sparkle{
      position:fixed; inset:0; pointer-events:none; z-index:1;
      background-image: radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.7) 50%, transparent 51%),
                        radial-gradient(2px 2px at 30% 35%, rgba(255,255,255,.6) 50%, transparent 51%),
                        radial-gradient(1.5px 1.5px at 55% 15%, rgba(255,255,255,.5) 50%, transparent 51%),
                        radial-gradient(2px 2px at 72% 42%, rgba(255,255,255,.45) 50%, transparent 51%),
                        radial-gradient(1.5px 1.5px at 85% 28%, rgba(255,255,255,.5) 50%, transparent 51%),
                        radial-gradient(1.8px 1.8px at 40% 70%, rgba(255,255,255,.55) 50%, transparent 51%),
                        radial-gradient(2px 2px at 15% 80%, rgba(255,255,255,.5) 50%, transparent 51%);
      opacity:.25;
      animation: twinkle 8s linear infinite;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.22; transform: translateY(0); }
      50%{ opacity:.32; transform: translateY(-6px); }
    }

    /* ============ OVERLAY ENVELOPE ============ */
    #letter-container{
      position:fixed; inset:0; background:#1c1429; display:flex; align-items:center; justify-content:center;
      z-index:10; transition: opacity 1.2s var(--soft), visibility 1.2s var(--soft);
    }
    #letter-container.hidden{ opacity:0; visibility:hidden; }

    .envelope-wrapper{ position:relative; text-align:center; }
    .envelope{
      position:relative; width:300px; height:190px;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,.35));
    }
    .flap.back{
      position:absolute; inset:0; background:#e9dfca; border-radius:12px;
    }
    .flap.front{
      position:absolute; left:0; top:0; width:100%; height:100px;
      border-top:95px solid #f0e8d9; border-right:150px solid transparent; border-left:150px solid transparent;
      border-radius:12px 12px 0 0; transform-origin:top; z-index:2; transition: transform .7s var(--soft);
    }
    .letter{
      position:absolute; left:5%; top:8px; width:90%; height:178px; border-radius:10px; background:#fff;
      display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
      z-index:1; box-shadow: 0 2px 8px rgba(0,0,0,.12);
      opacity:0; transform: translateY(10px); transition: all .7s var(--soft) .4s;
    }
    .letter p{ color:#555; font-size:1rem; }
    .letter strong{ font-family:'Dancing Script', cursive; font-size:2.2rem; color:#333; margin-top:6px; }
    .click-info{ margin-top:18px; color:rgba(255,255,255,.65); font-size:.95rem; font-style:italic; transition:opacity .6s var(--soft); }

    .envelope-wrapper.open .flap.front{ transform: rotateX(180deg); z-index:0; }
    .envelope-wrapper.open .letter{ opacity:1; transform:translateY(0); }
    .envelope-wrapper.open + .click-info{ opacity:0; }

    /* ============ TEXT MESSAGE ============ */
    .text-message{
      position:fixed; top:14%; left:50%; transform: translateX(-50%);
      width:min(90%, 820px); text-align:center; z-index:3; opacity:0; transition: opacity .8s var(--soft) .2s;
      pointer-events:none;
    }
    .to-you-text{
      font-family:'Dancing Script', cursive; font-size:3rem; font-weight:700;
      text-shadow: 0 4px 20px rgba(255,173,210,.25);
    }
    .main-text{
      margin-top:.5rem; font-size:1.2rem; line-height:1.6; opacity:.95;
      text-shadow: 0 2px 14px rgba(255,173,210,.18);
    }

    /* ============ FLOWERS ============ */
    .flowers{
      position:absolute; left:50%; bottom:0; transform: translateX(-50%) scale(.92);
      width: 100vw; height: 100vh; display:grid; place-items:end center; z-index:2; pointer-events:none;
      filter: drop-shadow(0 6px 36px rgba(255,180,210,.15));
    }
    .bouquet{
      position:relative; width: 56vmin; height: 70vmin; transform-origin:bottom center;
      /* gentle sway (lebih kalem) */
      animation: sway 9s ease-in-out infinite;
    }
    @keyframes sway{
      0%,100%{ transform: rotate(0deg); }
      50%{ transform: rotate(-1.2deg); }
    }

    /* stem */
    .stem{
      position:absolute; bottom:10vmin; left:50%; transform: translateX(-50%);
      width:1.4vmin; height:56vmin; border-radius:1vmin;
      background: linear-gradient(#1a7a34, #0f5b28);
      box-shadow: inset 0 0 4px rgba(0,0,0,.35);
      animation: grow 3.2s var(--soft) 0.2s backwards;
    }
    @keyframes grow{
      from{ height:0; opacity:0; }
      to{ height:56vmin; opacity:1; }
    }

    /* leaves */
    .leaf{
      position:absolute; width: 8vmin; height: 13vmin; border-radius: 45% 55% 50% 50% / 50% 50% 50% 50%;
      background: radial-gradient(60% 70% at 35% 35%, #1aac53 0%, #0c5a26 70%);
      filter: saturate(1.1);
      box-shadow: inset 0 0 10px rgba(255,255,255,.1);
    }
    .leaf.l1{ left: calc(50% + 1.6vmin); bottom: 38vmin; transform: rotate(24deg); animation: leafIn .8s var(--soft) .9s backwards; }
    .leaf.l2{ left: calc(50% - 8.8vmin); bottom: 32vmin; transform: rotate(-18deg); animation: leafIn .8s var(--soft) 1.05s backwards; }
    .leaf.l3{ left: calc(50% + 2.4vmin); bottom: 22vmin; transform: rotate(18deg); animation: leafIn .8s var(--soft) 1.2s backwards; }
    @keyframes leafIn{ from{ transform: scale(0) rotate(0); opacity:0; } }

    /* blossom */
    .blossom{
      position:absolute; left:50%; bottom: 56vmin; transform: translateX(-50%);
      width: 22vmin; height: 22vmin;
      filter: drop-shadow(0 10px 30px rgba(238,82,134,.25));
      animation: bloom 1.6s var(--soft) .6s backwards;
    }
    @keyframes bloom{ from{ transform: translateX(-50%) scale(0.2); opacity:0; } }

    .petal{
      position:absolute; left:50%; top:50%; width: 9vmin; height: 12vmin;
      transform-origin: bottom center; border-radius: 52% 48% 47% 53% / 50% 45% 55% 50%;
      background: radial-gradient(70% 80% at 45% 35%, #ff8db3 0%, var(--rose) 55%, var(--rose-deep) 100%);
      opacity:.98;
    }
    /* 8 kelopak dengan rotasi simetris */
    .p1{ transform: translate(-50%, -86%) rotate(0deg); }
    .p2{ transform: translate(-50%, -86%) rotate(45deg); }
    .p3{ transform: translate(-50%, -86%) rotate(90deg); }
    .p4{ transform: translate(-50%, -86%) rotate(135deg); }
    .p5{ transform: translate(-50%, -86%) rotate(180deg); }
    .p6{ transform: translate(-50%, -86%) rotate(225deg); }
    .p7{ transform: translate(-50%, -86%) rotate(270deg); }
    .p8{ transform: translate(-50%, -86%) rotate(315deg); }

    /* gentle breathing (lebih romantis, nggak liar) */
    .blossom{ animation: bloom 1.6s var(--soft) .6s backwards, breathe 6.5s ease-in-out .6s infinite; }
    @keyframes breathe{
      0%,100%{ transform: translateX(-50%) scale(1); }
      50%{ transform: translateX(-50%) scale(1.03); }
    }

    /* center */
    .core{
      position:absolute; left:50%; top:50%; transform: translate(-50%,-100%);
      width: 5.4vmin; height: 5.4vmin; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff 0%, #ffe0ef 45%, #ffb9d6 75%, #ff8ab6 100%);
      box-shadow: 0 0 28px 10px rgba(255,170,200,.28), inset 0 0 12px rgba(255,255,255,.7);
    }

    /* fireflies (lebih pelan) */
    .fireflies{
      position:absolute; inset:0; pointer-events:none; z-index:2;
    }
    .fly{
      position:absolute; width:8px; height:8px; border-radius:50%;
      background: radial-gradient(#fff, rgba(255,255,255,.2));
      opacity:.0; filter: blur(.2vmin);
      animation: float 8s linear infinite;
    }
    .fly:nth-child(1){ left: 48%; bottom: 22%; animation-delay: .3s; }
    .fly:nth-child(2){ left: 58%; bottom: 30%; animation-delay: 1.1s; }
    .fly:nth-child(3){ left: 40%; bottom: 26%; animation-delay: 1.9s; }
    .fly:nth-child(4){ left: 53%; bottom: 35%; animation-delay: 2.7s; }
    .fly:nth-child(5){ left: 46%; bottom: 18%; animation-delay: 3.4s; }
    @keyframes float{
      0%{ transform: translate(0,0); opacity:.0; }
      10%{ opacity:.85; }
      50%{ transform: translate(12px,-40px); opacity:.9; }
      90%{ opacity:.2; }
      100%{ transform: translate(-6px,-80px); opacity:0; }
    }

    /* ============ SIGNATURE ============ */
    .signature{
      position:fixed; right:24px; bottom:20px; z-index:3; opacity:0; transition: opacity 1s var(--soft) 1.8s;
    }
    .signature.show{ opacity:1; }
    .signature p{ font-family:'Dancing Script', cursive; font-size:1.7rem; color: rgba(255,255,255,.78); }

    /* ============ MUSIC CONTROLS ============ */
    .music-controls{
      position: fixed; left: 20px; bottom: 20px; z-index: 4;
      background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      border-radius: 14px; padding: 10px 12px; display:flex; gap:8px; align-items:center;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      opacity:0; transform: translateY(8px); transition: all .6s var(--soft);
    }
    .music-controls.show{ opacity:1; transform: translateY(0); }
    .music-controls button, .music-controls label{
      color:#fff; font-size:.9rem; cursor:pointer; border:none; border-radius:10px;
      background: rgba(255,255,255,.08); padding:8px 12px;
    }
    .music-controls input{ display:none; }
    .music-controls button:active{ transform: scale(.98); }

    /* ============ PLAY STATE GATE ============ */
    body.paused *{ animation-play-state: paused !important; }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 768px){
      .text-message{ top: 12%; width: min(92%, 760px); }
      .to-you-text{ font-size: 2.6rem; }
      .main-text{ font-size: 1.05rem; }
      .bouquet{ transform: scale(.96); }
    }
    @media (max-width: 480px){
      .text-message{ top: 10%; }
      .to-you-text{ font-size:2.1rem; }
      .main-text{ font-size:.95rem; }
      .bouquet{ transform: scale(1.04); }
      .music-controls{ left: 12px; right: 12px; gap:6px; padding:8px 10px; }
      .music-controls button, .music-controls label{ font-size:.85rem; padding:7px 10px; }
    }
  </style>
</head>
<body class="paused">
  <!-- SKY -->
  <div class="night"></div>
  <div class="sparkle"></div>

  <!-- OPENING ENVELOPE -->
  <div id="letter-container">
    <div class="envelope-wrapper" id="envWrap" role="button" aria-label="Buka surat">
      <div class="envelope">
        <div class="flap front"></div>
        <div class="flap back"></div>
        <div class="letter">
          <p>Spesial untuk,</p>
          <strong>Tasyaaa</strong>
        </div>
      </div>
    </div>
    <p class="click-info">(Klik untuk membuka)</p>
  </div>

  <!-- TITLE + MESSAGE (tetap sama) -->
  <div class="text-message" id="textMsg">
    <h2 class="to-you-text">Untuk Tasyaaaaa...</h2>
    <p class="main-text">Kalau bunga ini bisa bicara, dia pasti akan bilang kalau senyummu lebih indah dari kelopaknya.</p>
  </div>

  <!-- FLOWER -->
  <div class="flowers" aria-hidden="true">
    <div class="bouquet">
      <div class="stem"></div>
      <div class="leaf l1"></div>
      <div class="leaf l2"></div>
      <div class="leaf l3"></div>

      <div class="blossom">
        <div class="petal p1"></div>
        <div class="petal p2"></div>
        <div class="petal p3"></div>
        <div class="petal p4"></div>
        <div class="petal p5"></div>
        <div class="petal p6"></div>
        <div class="petal p7"></div>
        <div class="petal p8"></div>
        <div class="core"></div>
      </div>

      <div class="fireflies">
        <div class="fly"></div>
        <div class="fly"></div>
        <div class="fly"></div>
        <div class="fly"></div>
        <div class="fly"></div>
      </div>
    </div>
  </div>

  <!-- SIGNATURE -->
  <div class="signature" id="signature">
    <p>— dari Syukur</p>
  </div>

  <!-- MUSIC CONTROLS -->
  <div class="music-controls" id="musicCtl">
    <!-- NOTE: Taruh file musik bernama music.mp3 di folder yang sama agar langsung kebaca -->
    <audio id="bgm" loop preload="none">
      <!-- Default: coba load music.mp3 (opsional, boleh dihapus kalau mau selalu pilih manual) -->
      <source src="music.mp3" type="audio/mpeg" />
    </audio>

    <button id="togglePlay" type="button">Play</button>

    <!-- Input file -->
    <input type="file" id="musicFile" accept="audio/*" />
    <label for="musicFile" id="pickLabel">Pilih Musik</label>
  </div>

  <script>
    const envWrap = document.getElementById('envWrap');
    const letter = document.getElementById('letter-container');
    const textMsg = document.getElementById('textMsg');
    const signature = document.getElementById('signature');
    const musicCtl = document.getElementById('musicCtl');
    const audio = document.getElementById('bgm');
    const btnPlay = document.getElementById('togglePlay');
    const fileInput = document.getElementById('musicFile');

    let opened = false;

    // Helper: try play with catch (autoplay policy friendly)
    async function safePlay(){
      try{
        await audio.play();
        btnPlay.textContent = 'Pause';
      }catch(e){
        // If browser blocked autoplay, keep button as "Play"
        btnPlay.textContent = 'Play';
      }
    }

    envWrap.addEventListener('click', async () => {
      if(opened) return;
      opened = true;

      // buka amplop
      envWrap.classList.add('open');

      // tampilkan teks + signature + controls sesudah sedikit delay
      setTimeout(() => {
        letter.classList.add('hidden');               // fade overlay
        document.body.classList.remove('paused');     // start all animations
        textMsg.style.opacity = '1';                  // show text
        signature.classList.add('show');              // show signature
        musicCtl.classList.add('show');               // show music UI
      }, 800);

      // user gesture -> boleh mulai musik kalau ada sumber valid
      // prioritas: jika source default "music.mp3" ada dan bisa dimainkan
      if(audio.querySelector('source')?.getAttribute('src')){
        safePlay();
      }
    });

    btnPlay.addEventListener('click', async () => {
      if(audio.paused){
        await safePlay();
      }else{
        audio.pause();
        btnPlay.textContent = 'Play';
      }
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files?.[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      audio.src = url;
      audio.currentTime = 0;
      safePlay();
      // update label
      document.getElementById('pickLabel').textContent = file.name.length>18 ? (file.name.slice(0,16)+'…') : file.name;
    });
  </script>
</body>
</html>
